# Customer Churn Analytics — Technical Report

**Telco Customer Churn · SQL → R → Tableau**

This document describes the **methodology**, **pipeline**, **metrics**, and **reproducibility** for the Customer Churn Analytics Dashboard. It is intended for reviewers, collaborators, and anyone who wants to understand the end-to-end workflow from raw data to the published Tableau dashboard.

---

## 1. Objective

The project has four main goals:

| Goal | Description |
|------|-------------|
| **Identify churn patterns** | Find which customer segments (contract, tenure, internet, payment) have the highest churn rates. |
| **Quantify revenue at risk** | Measure MRR (monthly recurring revenue) from churned customers and the share of total revenue it represents. |
| **Support retention decisions** | Provide an executive-facing Tableau dashboard with clear KPIs and segment breakdowns for prioritization. |
| **Ensure reproducibility** | Document and automate the path from raw CSV → SQLite → R exports → Tableau so the pipeline can be re-run or extended. |

The public **Telco Customer Churn** dataset (Kaggle) is used as a case study. The pipeline cleanly separates **ingest (SQL)**, **transform (R)**, and **visualize (Tableau)**.

---

## 2. Pipeline Overview

```
Raw CSV (data/raw/)  →  SQL: staging + base + KPI views  →  R: export CSVs  →  Tableau: dashboard
                                    │                              │
                              data/churn.db                  data/processed/
                              (SQLite)                      (*.csv for Tableau)
```

| Stage | Tool | Input | Output | Purpose |
|-------|------|--------|--------|---------|
| **Ingest** | SQL | `telco-churn.csv` | `staging_churn`, `base_churn`, KPI views | Load, clean, normalize; define churn rate and MRR views. |
| **Transform** | R | `churn.db` (views + `base_churn`) | 7 CSVs in `data/processed/` | Query views and build contract×tenure, contract×internet driver tables. |
| **Visualize** | Tableau | Processed CSVs | Interactive dashboard | KPI cards, bar charts, heatmaps; published on Tableau Public. |

---

## 3. Data

### 3.1 Source and storage

- **Dataset:** [Telco Customer Churn](https://www.kaggle.com/datasets/blastchar/telco-customer-churn) (Kaggle).
- **Raw file:** `data/raw/telco-churn.csv` — unmodified, **tracked in Git** for reproducibility and GitHub Pages.
- **Database:** `data/churn.db` (SQLite) — created by the SQL pipeline; **not in Git**.
- **Processed outputs:** `data/processed/*.csv` — generated by R; used by Tableau.

### 3.2 Raw data (summary)

The CSV contains one row per customer, with columns such as:

- **Identifiers:** `customerID`
- **Demographics / services:** `gender`, `SeniorCitizen`, `Partner`, `Dependents`, `tenure`, `PhoneService`, `MultipleLines`, `InternetService`, `Contract`, `PaperlessBilling`, `PaymentMethod`
- **Monetary:** `MonthlyCharges`, `TotalCharges`
- **Target:** `Churn` (Yes/No in raw; converted to 0/1 in `base_churn`)

Empty or invalid `TotalCharges` are handled in SQL (treated as NULL). `Churn` is normalized to a binary flag for aggregation.

### 3.3 Base table (`base_churn`)

Created in `sql/queries/01_clean_staging.sql` from `staging_churn`:

- Column names normalized (e.g. `customer_id`, `monthly_charges`, `churn`).
- `churn`: `1` if customer churned, `0` otherwise.
- `total_charges`: numeric; blanks cast to NULL.
- Text fields trimmed and nulls coalesced.

All KPI views and R exports are built from `base_churn`.

### 3.4 Processed outputs (Tableau data sources)

| File | Rows | Description |
|------|------|-------------|
| `kpi_overall.csv` | 1 | Overall KPIs: total customers, churned, retained, churn_rate_pct, total_mrr, mrr_at_risk, pct_revenue_at_risk. |
| `kpi_by_contract.csv` | 4 | Churn rate and MRR (and MRR at risk) by contract type (Month-to-month, One year, Two year). |
| `kpi_by_payment.csv` | 5 | Same metrics by payment method (e.g. Electronic check, Mailed check, Bank transfer, Credit card). |
| `kpi_by_tenure_bucket.csv` | 5 | Same metrics by tenure band: 0–12, 13–24, 25–36, 37–48, 49+ months. |
| `kpi_by_internet.csv` | 4 | Same metrics by internet service (Fiber optic, DSL, No). |
| `churn_drivers_contract_tenure.csv` | 16 | Two-way: contract × tenure_bucket (n, churned, churn_rate_pct, mrr, mrr_at_risk). |
| `churn_drivers_contract_internet.csv` | 11 | Two-way: contract × internet_service (same metrics). |

---

## 4. Key Metrics

Definitions used consistently in SQL views and R exports:

| Metric | Definition |
|--------|------------|
| **Churn rate (%)** | `100 × (number of churned customers) / (total customers)` in the segment. |
| **MRR** | Sum of `monthly_charges` in the segment. |
| **MRR at risk** | Sum of `monthly_charges` only for customers with `churn = 1`. |
| **% revenue at risk** | `100 × (MRR at risk) / (total MRR)` — share of total MRR lost to churn. |

**Tenure buckets** (used in SQL and R): `0-12`, `13-24`, `25-36`, `37-48`, `49+` months.

---

## 5. Methodology (by stage)

### 5.1 SQL

1. **Schema** (`sql/schema/create_tables.sql`): Defines `staging_churn` with columns matching the raw CSV for direct import.
2. **Cleaning** (`sql/queries/01_clean_staging.sql`): Builds `base_churn` from `staging_churn` with normalized names, numeric `churn`, and cleaned `total_charges`.
3. **KPI views** (`sql/queries/02_kpi_views.sql`): Defines:
   - `v_churn_kpi` — one row: totals and overall churn rate, MRR, MRR at risk, % revenue at risk.
   - `v_churn_by_contract`, `v_churn_by_payment`, `v_churn_by_tenure_bucket`, `v_churn_by_internet` — one row per segment with `n`, `churned`, `churn_rate_pct`, `mrr`, `mrr_at_risk`.

All views aggregate from `base_churn`; R scripts query these views and write CSVs.

### 5.2 R

1. **02_kpi_tables.R:** Connects to `data/churn.db`, runs `SELECT *` on each KPI view, writes 5 CSVs to `data/processed/` (overall + by contract, payment, tenure bucket, internet).
2. **03_churn_drivers.R:** Reads `base_churn` from the DB, adds `tenure_bucket` in R (same bands as SQL), then:
   - Groups by `contract` and `tenure_bucket` → `churn_drivers_contract_tenure.csv`
   - Groups by `contract` and `internet_service` → `churn_drivers_contract_internet.csv`

Dependencies: `DBI`, `RSQLite`, `dplyr`, `readr` (see `r/utils/requirements.R`).

### 5.3 Tableau

- **Data source:** All sheets use the CSVs in `data/processed/` (no live connection to SQLite).
- **Workbook:** Stored in `tableau/` (e.g. `Customer Churn Dashboard – Telco.twbx`) and tracked in the repository.
- **Publish:** Dashboard is published on Tableau Public for viewing in the browser.

---

## 6. Dashboard

The main deliverable is an interactive dashboard on Tableau Public:

**[Customer Churn Dashboard — Telco](https://public.tableau.com/app/profile/ilian.khankhalaev/viz/CustomerChurnDashboardTelco/Dashboard1?publish=yes)**

It connects to the processed CSVs and includes:

- **KPI summary** — Total customers, churned vs retained, churn rate (%), total MRR, MRR at risk, % revenue at risk.
- **Churn by segment** — Bar charts of churn rate by contract, tenure bucket, internet service, and payment method.
- **Contract × Tenure** — Heatmap (or matrix) of churn rate and MRR at risk by contract and tenure band.
- **Contract × Internet** — Heatmap of churn and revenue at risk by contract and internet service type.
- **Revenue focus** — MRR vs MRR at risk by contract and segment to support retention prioritization.

Filters allow narrowing by contract, tenure, or segment. No local Tableau installation is required to view the published dashboard.

---

## 7. Reproducibility

Follow these steps to reproduce the pipeline and dashboard data.

### 7.1 Prerequisites

- **SQLite** (or another SQL engine; adjust paths/commands if needed).
- **R** (e.g. 4.x) with packages: `DBI`, `RSQLite`, `dplyr`, `readr` (and optionally `tidyr`). Run `source("r/utils/requirements.R")` from the project root to load/install as needed.
- **Raw data:** Place the Telco Churn CSV at `data/raw/telco-churn.csv` (or ensure it is already there; the repo may include it).

### 7.2 Step-by-step

| Step | Action |
|------|--------|
| 1 | Clone the repo and set working directory to the project root. |
| 2 | Load raw data into SQLite: create schema, then import `data/raw/telco-churn.csv` into `staging_churn` (mechanism depends on your environment; e.g. SQLite CLI or a small script). |
| 3 | Run SQL in order: `sql/schema/create_tables.sql` → `sql/queries/01_clean_staging.sql` → `sql/queries/02_kpi_views.sql`. This creates `data/churn.db` (or your target DB) with `base_churn` and all KPI views. |
| 4 | In R, from project root: `source("r/utils/requirements.R")`, then `source("r/scripts/02_kpi_tables.R")` and `source("r/scripts/03_churn_drivers.R")`. This writes all 7 CSVs to `data/processed/`. |
| 5 | In Tableau, point the workbook’s data sources to the CSVs in `data/processed/` and refresh. Optionally publish to Tableau Public. |

After step 4, the Tableau workbook in `tableau/` can be opened and refreshed against `data/processed/` to reproduce the dashboard locally.

---

## 8. Summary

| Deliverable | Description |
|-------------|-------------|
| **Pipeline** | Raw CSV → SQLite (staging, base, KPI views) → R (KPI + driver CSVs) → Tableau. |
| **Metrics** | Churn rate (%), MRR, MRR at risk, % revenue at risk; segment and two-way breakdowns. |
| **Dashboard** | Tableau Public dashboard with KPIs, segment bars, and contract×tenure / contract×internet heatmaps. |
| **Reproducibility** | Documented steps and code; raw data and workbook in repo; processed CSVs generated by R. |

For a high-level overview and screenshots, see the main [**README**](README.md). For a mapping of which plots use which datasets, see `tableau/PLOTS_AND_DATA.md` (if present in your clone).
